# JadeDB ä¸‰å±‚æ¶æ„åè°ƒè®¾è®¡

## ğŸ¯ æ¶æ„æ¦‚è¿°

JadeDBé‡‡ç”¨æ¸…æ™°çš„ä¸‰å±‚æ¶æ„è®¾è®¡ï¼Œæ¯å±‚èŒè´£æ˜ç¡®ï¼Œé€šè¿‡æ¥å£è¿›è¡Œåè°ƒï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    transaction å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ TransactionMgr  â”‚  â”‚   MVCCManager   â”‚  â”‚  LockManager    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     storage å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   LSMEngine     â”‚  â”‚  BTreeEngine    â”‚  â”‚ DistributedEng  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   distributed å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ TxnCoordinator  â”‚  â”‚   Consensus     â”‚  â”‚ DistributedStor â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å±‚æ¬¡èŒè´£

### 1. **transactionå±‚** - äº‹åŠ¡ç®¡ç†ï¼ˆä¸Šå±‚ï¼‰
- **èŒè´£**ï¼šç»Ÿä¸€äº‹åŠ¡æ¥å£ã€MVCCç®¡ç†ã€é”ç®¡ç†ã€æ—¶é—´æˆ³ç®¡ç†
- **å¯¹å¤–æ¥å£**ï¼š`Transaction`ã€`TransactionManager`
- **ä¾èµ–**ï¼šä¾èµ–storageå±‚çš„Engineæ¥å£

### 2. **storageå±‚** - å­˜å‚¨æŠ½è±¡ï¼ˆä¸­å±‚ï¼‰
- **èŒè´£**ï¼šç»Ÿä¸€å­˜å‚¨å¼•æ“æ¥å£ã€å¼•æ“å·¥å‚ã€å­˜å‚¨é€‚é…
- **å¯¹å¤–æ¥å£**ï¼š`Engine`ã€`EngineFactory`
- **ä¾èµ–**ï¼šä¾èµ–distributedå±‚çš„æ¥å£ï¼ˆä»…åˆ†å¸ƒå¼å¼•æ“ï¼‰

### 3. **distributedå±‚** - åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½ï¼ˆåº•å±‚ï¼‰
- **èŒè´£**ï¼šåˆ†å¸ƒå¼å…±è¯†ã€äº‹åŠ¡åè°ƒã€åˆ†å¸ƒå¼å­˜å‚¨
- **å¯¹å¤–æ¥å£**ï¼š`DistributedService`ã€å„ç§åˆ†å¸ƒå¼æ¥å£
- **ä¾èµ–**ï¼šæ— å¤–éƒ¨ä¾èµ–ï¼ˆåº•å±‚ï¼‰

## ğŸ”— æ¥å£åè°ƒ

### 1. **transaction â†’ storage**
```go
// transactionå±‚é€šè¿‡storage.Engineæ¥å£ä½¿ç”¨å­˜å‚¨å¼•æ“
type Engine interface {
    BeginTransaction(txnManager *TransactionManager, options *TransactionOptions) (Transaction, error)
    Put(key, value []byte) error
    Get(key []byte) ([]byte, error)
    // ... å…¶ä»–æ–¹æ³•
}

// ä½¿ç”¨æ–¹å¼
engine := factory.CreateEngine(LSMTreeEngine, nil)
txn, err := engine.BeginTransaction(txnManager, options)
```

### 2. **storage â†’ distributed**
```go
// storageå±‚é€šè¿‡distributedæ¥å£ä½¿ç”¨åˆ†å¸ƒå¼æœåŠ¡
type DistributedService interface {
    GetTransactionCoordinator() DistributedTransactionCoordinator
    GetConsensus() DistributedConsensus
    GetStorage() DistributedStorage
}

// ä½¿ç”¨æ–¹å¼ï¼ˆä»…åˆ†å¸ƒå¼å¼•æ“ï¼‰
distributedService := distributed.NewDistributedService(config)
coordinator := distributedService.GetTransactionCoordinator()
```

### 3. **å„å±‚å†…éƒ¨åè°ƒ**
```go
// transactionå±‚å†…éƒ¨
type TransactionManager struct {
    mvccManager     *MVCCManager
    lockManager     *LockManager
    timestampOracle *TimestampOracle
}

// storageå±‚å†…éƒ¨
type EngineFactory interface {
    CreateEngine(engineType EngineType, config interface{}) (Engine, error)
}

// distributedå±‚å†…éƒ¨
type DistributedService interface {
    GetTransactionCoordinator() DistributedTransactionCoordinator
    GetConsensus() DistributedConsensus
    GetStorage() DistributedStorage
}
```

## ğŸ¯ ä¾èµ–å…³ç³»

### âœ… **æ­£ç¡®çš„ä¾èµ–æ–¹å‘**
```
transaction â†’ storage â†’ distributed
```

### âŒ **é¿å…çš„å¾ªç¯ä¾èµ–**
- transaction â†” storage
- storage â†” distributed
- transaction â†” distributed

### ğŸ”§ **ä¾èµ–æ³¨å…¥**
```go
// 1. åˆ›å»ºåº•å±‚æœåŠ¡
distributedService := distributed.NewDistributedService(config)

// 2. åˆ›å»ºå­˜å‚¨å¼•æ“ï¼ˆæ³¨å…¥åˆ†å¸ƒå¼æœåŠ¡ï¼‰
engine := storage.NewDistributedEngine(&storage.DistributedEngineConfig{
    DistributedConfig: config,
})

// 3. åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨
txnManager := transaction.NewTransactionManager(txnConfig)

// 4. è®¾ç½®é»˜è®¤å¼•æ“
txnManager.SetDefaultEngine(engine)

// 5. ä½¿ç”¨ç»Ÿä¸€æ¥å£
txn, err := txnManager.BeginTransaction(options)
```

## ğŸš€ ä½¿ç”¨åœºæ™¯

### 1. **å•æœºéƒ¨ç½²**
```go
// åªä½¿ç”¨transaction + storageå±‚
factory := storage.GetEngineFactory()
engine, _ := factory.CreateEngine(storage.LSMTreeEngine, nil)
txnManager, _ := transaction.NewTransactionManager(config)
txn, _ := engine.BeginTransaction(txnManager, options)
```

### 2. **åˆ†å¸ƒå¼éƒ¨ç½²**
```go
// ä½¿ç”¨å…¨éƒ¨ä¸‰å±‚
distributedService, _ := distributed.NewDistributedService(distConfig)
engine, _ := storage.NewDistributedEngine(engineConfig)
txnManager, _ := transaction.NewTransactionManager(txnConfig)
txn, _ := engine.BeginTransaction(txnManager, options)
```

### 3. **æ··åˆéƒ¨ç½²**
```go
// æ ¹æ®éœ€è¦é€‰æ‹©å¼•æ“ç±»å‹
if isDistributed {
    engine = storage.NewDistributedEngine(config)
} else {
    engine, _ = factory.CreateEngine(storage.BPlusTreeEngine, nil)
}
```

## ğŸ” åè°ƒéªŒè¯

### 1. **æ¥å£ä¸€è‡´æ€§**
- âœ… æ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½å®ç°`storage.Engine`æ¥å£
- âœ… æ‰€æœ‰äº‹åŠ¡éƒ½å®ç°`transaction.Transaction`æ¥å£
- âœ… åˆ†å¸ƒå¼æœåŠ¡é€šè¿‡æ¥å£æš´éœ²åŠŸèƒ½

### 2. **ä¾èµ–æ–¹å‘**
- âœ… transactionå±‚ä¸ç›´æ¥ä¾èµ–distributedå±‚
- âœ… storageå±‚é€šè¿‡æ¥å£ä½¿ç”¨distributedå±‚
- âœ… å„å±‚èŒè´£æ¸…æ™°ï¼Œæ— å¾ªç¯ä¾èµ–

### 3. **æ‰©å±•æ€§**
- âœ… æ·»åŠ æ–°å­˜å‚¨å¼•æ“ï¼šåªéœ€å®ç°`storage.Engine`æ¥å£
- âœ… æ·»åŠ æ–°åˆ†å¸ƒå¼åè®®ï¼šåªéœ€å®ç°distributedæ¥å£
- âœ… ä¿®æ”¹äº‹åŠ¡é€»è¾‘ï¼šä¸å½±å“å­˜å‚¨å’Œåˆ†å¸ƒå¼å±‚

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### 1. **æ¥å£å¼€é”€**
- é€šè¿‡æ¥å£è°ƒç”¨çš„å¼€é”€å¾ˆå°
- Goçš„æ¥å£è°ƒç”¨ç»è¿‡ä¼˜åŒ–
- ç›¸æ¯”ç½‘ç»œå’Œç£ç›˜IOï¼Œæ¥å£å¼€é”€å¯å¿½ç•¥

### 2. **å±‚æ¬¡ç©¿é€**
- é¿å…ä¸å¿…è¦çš„å±‚æ¬¡ç©¿é€
- æ‰¹é‡æ“ä½œåœ¨å„å±‚éƒ½æœ‰ä¼˜åŒ–
- ç¼“å­˜åœ¨åˆé€‚çš„å±‚æ¬¡å®ç°

### 3. **å¹¶å‘æ§åˆ¶**
- å„å±‚éƒ½æœ‰é€‚å½“çš„å¹¶å‘æ§åˆ¶
- é”çš„ç²’åº¦åœ¨å„å±‚éƒ½ç»è¿‡ä¼˜åŒ–
- é¿å…è·¨å±‚çš„é”ç«äº‰

## ğŸ‰ æ€»ç»“

JadeDBçš„ä¸‰å±‚æ¶æ„å®ç°äº†ï¼š

1. **èŒè´£æ¸…æ™°**ï¼šæ¯å±‚åªè´Ÿè´£è‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½
2. **æ¥å£ç»Ÿä¸€**ï¼šé€šè¿‡æ¥å£å®ç°å±‚é—´åè°ƒ
3. **ä¾èµ–åˆç†**ï¼šå•å‘ä¾èµ–ï¼Œæ— å¾ªç¯
4. **æ‰©å±•æ€§å¥½**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ–°å¼•æ“
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šå„å±‚éƒ½æœ‰é’ˆå¯¹æ€§çš„ä¼˜åŒ–

è¿™ç§è®¾è®¡ä¸ºJadeDBæä¾›äº†ï¼š
- ğŸ—ï¸ **æ¸…æ™°çš„æ¶æ„**ï¼šæ˜“äºç†è§£å’Œç»´æŠ¤
- ğŸ”§ **çµæ´»çš„é…ç½®**ï¼šæ”¯æŒå•æœºå’Œåˆ†å¸ƒå¼éƒ¨ç½²
- ğŸš€ **è‰¯å¥½çš„æ€§èƒ½**ï¼šå„å±‚ä¼˜åŒ–ï¼Œæ•´ä½“é«˜æ•ˆ
- ğŸ“ˆ **å¼ºå¤§çš„æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

é€šè¿‡è¿™ç§ä¸‰å±‚åè°ƒè®¾è®¡ï¼ŒJadeDBèƒ½å¤Ÿåœ¨ä¿æŒæ¶æ„æ¸…æ™°çš„åŒæ—¶ï¼Œæä¾›å¼ºå¤§çš„åŠŸèƒ½å’Œä¼˜å¼‚çš„æ€§èƒ½ã€‚
